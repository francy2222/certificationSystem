<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maggiore e Minore - Esercizi Interattivi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 2em;
        }

        /* Info Bar */
        .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .timer-display {
            font-size: 1.2em;
            color: #667eea;
            font-weight: bold;
            padding: 8px 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #667eea;
        }

        .student-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            justify-content: center;
        }

        .student-badge {
            padding: 8px 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #667eea;
            color: #667eea;
            font-weight: bold;
        }

        .student-badge.registered {
            border-color: #4caf50;
            color: #4caf50;
        }

        /* Selezione Livello */
        .level-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .level-btn {
            padding: 12px 25px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }

        .level-btn:hover {
            background: #f0f0ff;
            transform: translateY(-2px);
        }

        .level-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .level-description {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        /* Area Esercizio */
        .exercise-area {
            background: #f5f5f5;
            padding: 40px 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Numeri e Simboli */
        .numbers-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .number-display {
            font-size: 72px;
            font-weight: bold;
            color: #667eea;
            min-width: 200px;
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .symbol-choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .symbol-btn {
            width: 100px;
            height: 100px;
            font-size: 48px;
            font-weight: bold;
            border: 3px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .symbol-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .symbol-btn.selected {
            background: #667eea;
            color: white;
        }

        /* Righelli per livello 3 */
        .rulers-container {
            display: none;
            width: 100%;
            margin: 20px 0;
            gap: 20px;
        }

        .rulers-container.visible {
            display: flex;
            flex-direction: column;
        }

        .ruler-wrapper {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .ruler-label {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .ruler {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 80px;
            background: linear-gradient(to bottom, #ffffff 0%, #f8f8f8 100%);
            border: 2px solid #333;
            border-radius: 3px;
            margin: 10px auto;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .tick {
            position: absolute;
            bottom: 0;
            width: 1px;
            background: #333;
        }

        .tick.mm {
            height: 15px;
            background: #666;
        }

        .tick.mm5 {
            height: 25px;
            width: 1.5px;
            background: #444;
        }

        .tick.cm {
            height: 35px;
            width: 2px;
            background: #222;
        }

        .number-ruler {
            position: absolute;
            bottom: 40px;
            font-size: 16px;
            font-weight: bold;
            transform: translateX(-50%);
            color: #000;
        }

        .marker {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 15px solid #f44336;
            bottom: -17px;
            transform: translateX(-50%);
            z-index: 10;
        }

        .marker::after {
            content: '';
            position: absolute;
            width: 3px;
            height: 80px;
            background: #f44336;
            left: 50%;
            transform: translateX(-50%);
            bottom: 15px;
        }

        /* Bottoni */
        .btn {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            color: #333;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* Feedback */
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease;
            display: none;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: translateY(-10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
            display: block !important;
        }

        .feedback.wrong {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
            display: block !important;
        }

        /* Punteggio */
        .score {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .score-item {
            text-align: center;
        }

        .score-value {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }

        .score-label {
            color: #666;
            margin-top: 5px;
        }

        /* Pannello Certificato */
        .certificate-panel {
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            .number-display {
                font-size: 48px;
                min-width: 150px;
            }

            .symbol-btn {
                width: 80px;
                height: 80px;
                font-size: 36px;
            }

            .numbers-container {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>➕➖ Maggiore e Minore - Esercizi Interattivi</h1>
        
        <!-- Barra Info -->
        <div class="info-bar">
            <div class="timer-display" id="timerDisplay">⏱️ 00:00</div>
            
            <div class="student-info">
                <div class="student-badge" id="studentBadge">👤 Non registrato</div>
                <button class="btn btn-primary" id="studentBtn">📝 Registra</button>
            </div>
        </div>
        
        <!-- Selezione Livello -->
        <div class="level-selector">
            <button class="level-btn active" onclick="setLevel(1)">Livello 1</button>
            <button class="level-btn" onclick="setLevel(2)">Livello 2</button>
            <button class="level-btn" onclick="setLevel(3)">Livello 3</button>
        </div>
        
        <div class="level-description" id="levelDescription">
            <strong>Livello 1:</strong> Numeri interi entro 100
        </div>

        <!-- Area Esercizio -->
        <div class="exercise-area">
            <!-- Righelli per livello 3 -->
            <div class="rulers-container" id="rulersContainer">
                <div class="ruler-wrapper">
                    <div class="ruler-label" id="ruler1Label">5,3</div>
                    <div class="ruler" id="ruler1"></div>
                </div>
                <div class="ruler-wrapper">
                    <div class="ruler-label" id="ruler2Label">7,8</div>
                    <div class="ruler" id="ruler2"></div>
                </div>
            </div>

            <!-- Numeri e Simboli -->
            <div class="numbers-container">
                <div class="number-display" id="number1">12</div>
                
                <div class="symbol-choices">
                    <button class="symbol-btn" onclick="selectSymbol('<')">&lt;</button>
                    <button class="symbol-btn" onclick="selectSymbol('=')">=</button>
                    <button class="symbol-btn" onclick="selectSymbol('>')">&gt;</button>
                </div>
                
                <div class="number-display" id="number2">17</div>
            </div>

            <div class="feedback" id="feedback"></div>
        </div>

        <!-- Bottoni Azione -->
        <div class="action-buttons">
            <button class="btn btn-success" onclick="checkAnswer()">✅ Verifica</button>
            <button class="btn btn-warning" onclick="newQuestion()">🔄 Nuova Domanda</button>
        </div>

        <!-- Punteggio -->
        <div class="score">
            <div class="score-item">
                <div class="score-value" id="correctScore">0</div>
                <div class="score-label">Corrette</div>
            </div>
            <div class="score-item">
                <div class="score-value" id="totalScore">0</div>
                <div class="score-label">Totali</div>
            </div>
            <div class="score-item">
                <div class="score-value" id="percentScore">0%</div>
                <div class="score-label">Precisione</div>
            </div>
        </div>

        <!-- Pannello Certificato -->
        <div class="certificate-panel" id="certificateContainer"></div>
    </div>

    <!-- Sistema Certificazione v4.0 -->
    <script src="https://certificationsystem.netlify.app/certification-system.js"></script>

    <script>
        //#region Variabili globali
        let currentLevel = 1;
        let num1 = 0;
        let num2 = 0;
        let correctSymbol = '';
        let selectedSymbol = '';
        let correctCount = 0;
        let totalCount = 0;
        let certSystem = null;
        let isWaitingForAnswer = false;

        // Scala righello: 1mm = 50px (per coprire 10cm in 500px)
        const RULER_SCALE = 50;
        //#endregion

        //#region Sistema Certificazione
        function initCertificationSystem() {
            certSystem = new CertificationSystem({
                appName: 'Maggiore e Minore',
                appVersion: '1.0.0',
                storageKey: 'maggiore_minore_cert',
                certUrl: 'https://certificationsystem.netlify.app/',
                trackFocus: true,
                
                fields: [
                    { key: 'domande', label: 'Domande Totali', showZero: false },
                    { key: 'corrette', label: 'Risposte Corrette', showZero: false },
                    { key: 'sbagliate', label: 'Risposte Sbagliate', showZero: true },
                    { key: 'liv1_corrette', label: 'Livello 1 Corrette', showZero: false },
                    { key: 'liv2_corrette', label: 'Livello 2 Corrette', showZero: false },
                    { key: 'liv3_corrette', label: 'Livello 3 Corrette', showZero: false },
                    { key: 'precisione', label: 'Precisione %', showZero: true, type: 'percentage' }
                ],
                
                onTimerUpdate: (time) => {
                    const minutes = Math.floor(time / 60);
                    const seconds = time % 60;
                    document.getElementById('timerDisplay').textContent = 
                        `⏱️ ${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
                },
                
                onFieldUpdate: () => {
                    // Il pannello si aggiorna automaticamente con renderFullPanel
                },
                
                onReset: () => {
                    correctCount = 0;
                    totalCount = 0;
                    updateScore();
                    document.getElementById('feedback').style.display = 'none';
                }
            });
            
            // Render pannello certificato completo
            certSystem.renderFullPanel('certificateContainer', {
                collapsible: true,
                showStudentControls: true,
                showClassroomToggle: true,
                showVerificationToggle: true
            });
        }

        function updateStudentBadge() {
            const info = certSystem.getStudentInfo();
            const badge = document.getElementById('studentBadge');
            
            if (info && info.nome) {
                badge.textContent = `👤 ${info.nome} ${info.cognome}`;
                badge.classList.add('registered');
            } else {
                badge.textContent = '👤 Non registrato';
                badge.classList.remove('registered');
            }
        }
        //#endregion

        //#region Suoni
        const sounds = {
            correct: new Audio('https://certificationsystem.netlify.app/application/sounds/level-complete-394515.mp3'),
            wrong: new Audio('https://certificationsystem.netlify.app/application/sounds/wrong-47985.mp3'),
            click: new Audio('https://certificationsystem.netlify.app/application/sounds/click2.mp3')
        };

        function playSound(soundName) {
            if (sounds[soundName]) {
                sounds[soundName].currentTime = 0;
                sounds[soundName].play().catch(e => console.log('Audio play failed:', e));
            }
        }
        //#endregion

        //#region Righelli Livello 3
        function initRuler(rulerId) {
            const ruler = document.getElementById(rulerId);
            ruler.innerHTML = '';
            
            // Disegna tacche per 10cm (100mm)
            for (let mm = 0; mm <= 100; mm++) {
                const tick = document.createElement('div');
                tick.className = 'tick';
                tick.style.left = (mm * RULER_SCALE / 10) + 'px';
                
                if (mm % 10 === 0) {
                    // Ogni centimetro
                    const cm = mm / 10;
                    tick.className = 'tick cm';
                    
                    const num = document.createElement('div');
                    num.className = 'number-ruler';
                    num.style.left = (mm * RULER_SCALE / 10) + 'px';
                    num.textContent = cm;
                    ruler.appendChild(num);
                } else if (mm % 5 === 0) {
                    tick.className = 'tick mm5';
                } else {
                    tick.className = 'tick mm';
                }
                
                ruler.appendChild(tick);
            }
        }

        function showNumberOnRuler(rulerId, labelId, number) {
            const ruler = document.getElementById(rulerId);
            const label = document.getElementById(labelId);
            
            // Aggiorna label
            label.textContent = number.toString().replace('.', ',');
            
            // Posiziona marker
            const positionMm = number * 10; // Converti in millimetri
            const positionPx = positionMm * RULER_SCALE / 10;
            
            // Rimuovi marker precedente
            const oldMarker = ruler.querySelector('.marker');
            if (oldMarker) oldMarker.remove();
            
            // Aggiungi nuovo marker
            const marker = document.createElement('div');
            marker.className = 'marker';
            marker.style.left = positionPx + 'px';
            ruler.appendChild(marker);
        }
        //#endregion

        //#region Gestione Livelli
        function setLevel(level) {
            currentLevel = level;
            
            // Aggiorna bottoni
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Aggiorna descrizione
            const descriptions = {
                1: '<strong>Livello 1:</strong> Numeri interi entro 100',
                2: '<strong>Livello 2:</strong> Numeri interi entro 10000',
                3: '<strong>Livello 3:</strong> Numeri decimali entro 10 con righello visivo'
            };
            document.getElementById('levelDescription').innerHTML = descriptions[level];
            
            // Gestisci visibilità righelli
            const rulersContainer = document.getElementById('rulersContainer');
            if (level === 3) {
                rulersContainer.classList.add('visible');
                initRuler('ruler1');
                initRuler('ruler2');
            } else {
                rulersContainer.classList.remove('visible');
            }
            
            // Genera nuova domanda
            newQuestion();
        }

        function generateNumbers() {
            switch(currentLevel) {
                case 1:
                    // Numeri interi entro 100
                    num1 = Math.floor(Math.random() * 100) + 1;
                    num2 = Math.floor(Math.random() * 100) + 1;
                    break;
                    
                case 2:
                    // Numeri interi entro 10000
                    num1 = Math.floor(Math.random() * 10000) + 1;
                    num2 = Math.floor(Math.random() * 10000) + 1;
                    break;
                    
                case 3:
                    // Decimali entro 10 con una cifra decimale
                    num1 = Math.round((Math.random() * 99 + 1)) / 10; // 0.1 - 10.0
                    num2 = Math.round((Math.random() * 99 + 1)) / 10;
                    
                    // Mostra sui righelli
                    showNumberOnRuler('ruler1', 'ruler1Label', num1);
                    showNumberOnRuler('ruler2', 'ruler2Label', num2);
                    break;
            }
            
            // Determina simbolo corretto
            if (num1 < num2) {
                correctSymbol = '<';
            } else if (num1 > num2) {
                correctSymbol = '>';
            } else {
                correctSymbol = '=';
            }
        }

        function newQuestion() {
            isWaitingForAnswer = true;
            selectedSymbol = '';
            
            // Reset feedback
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'none';
            feedback.className = 'feedback';
            
            // Reset selezione simboli
            document.querySelectorAll('.symbol-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Genera nuovi numeri
            generateNumbers();
            
            // Mostra numeri
            const num1Display = document.getElementById('number1');
            const num2Display = document.getElementById('number2');
            
            if (currentLevel === 3) {
                num1Display.textContent = num1.toString().replace('.', ',');
                num2Display.textContent = num2.toString().replace('.', ',');
            } else {
                num1Display.textContent = num1;
                num2Display.textContent = num2;
            }
        }

        function selectSymbol(symbol) {
            if (!isWaitingForAnswer) return;
            
            playSound('click');
            selectedSymbol = symbol;
            
            // Evidenzia simbolo selezionato
            document.querySelectorAll('.symbol-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent.includes(symbol)) {
                    btn.classList.add('selected');
                }
            });
        }

        function checkAnswer() {
            if (!isWaitingForAnswer) return;
            
            const feedback = document.getElementById('feedback');
            
            if (!selectedSymbol) {
                feedback.textContent = '⚠️ Seleziona un simbolo prima di verificare!';
                feedback.className = 'feedback wrong';
                feedback.style.display = 'block';
                playSound('wrong');
                return;
            }
            
            isWaitingForAnswer = false;
            totalCount++;
            certSystem.incrementField('domande');
            
            if (selectedSymbol === correctSymbol) {
                correctCount++;
                certSystem.incrementField('corrette');
                certSystem.incrementField(`liv${currentLevel}_corrette`);
                
                feedback.textContent = '✅ Corretto! Ottimo lavoro!';
                feedback.className = 'feedback correct';
                feedback.style.display = 'block';
                playSound('correct');
                
                // Nuova domanda dopo 2 secondi
                setTimeout(() => {
                    newQuestion();
                }, 2000);
            } else {
                certSystem.incrementField('sbagliate');
                
                const symbolText = {
                    '<': 'minore (<)',
                    '>': 'maggiore (>)',
                    '=': 'uguale (=)'
                };
                
                feedback.textContent = `❌ Sbagliato! ${num1} è ${symbolText[correctSymbol]} di ${num2}`;
                feedback.className = 'feedback wrong';
                feedback.style.display = 'block';
                playSound('wrong');
                
                // Nuova domanda dopo 3 secondi
                setTimeout(() => {
                    newQuestion();
                }, 3000);
            }
            
            updateScore();
        }

        function updateScore() {
            document.getElementById('correctScore').textContent = correctCount;
            document.getElementById('totalScore').textContent = totalCount;
            
            const percentage = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;
            document.getElementById('percentScore').textContent = percentage + '%';
            
            certSystem.setField('precisione', percentage);
        }
        //#endregion

        //#region Inizializzazione
        window.addEventListener('DOMContentLoaded', () => {
            // Inizializza sistema certificazione
            initCertificationSystem();
            
            // Genera prima domanda
            newQuestion();
            
            // Gestione registrazione studente
            document.getElementById('studentBtn').addEventListener('click', () => {
                certSystem.promptStudentInfo();
                updateStudentBadge();
            });
        });
        //#endregion
    </script>
</body>
</html>
