<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impara i Complementi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .level-info {
            text-align: center;
            margin-bottom: 30px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
        }

        .level-info h2 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .progress {
            text-align: center;
            font-size: 1.2em;
            color: #333;
            margin-bottom: 20px;
        }

        .question-area {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question {
            font-size: 1.4em;
            color: #333;
            text-align: center;
        }

        .highlight {
            color: #e74c3c;
            font-weight: bold;
            padding: 0 5px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .association-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .column-title {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
        }

        .question-item, .complement-item {
            padding: 15px;
            font-size: 1em;
            background: white;
            border: 3px solid #667eea;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
            font-weight: 600;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question-item {
            background: #e8eaf6;
        }

        .question-item:hover:not(.matched) {
            background: #d1d5f7;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .complement-item:hover:not(.matched) {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .complement-item.selected {
            background: #ffd700;
            border-color: #ffd700;
            color: #333;
        }

        .question-item.matched {
            background: #2ecc71;
            border-color: #2ecc71;
            color: white;
            cursor: default;
        }

        .complement-item.matched {
            background: #2ecc71;
            border-color: #2ecc71;
            color: white;
            cursor: default;
        }

        .option-btn {
            padding: 20px;
            font-size: 1.1em;
            background: white;
            border: 3px solid #667eea;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
            font-weight: 600;
        }

        .option-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .option-btn.correct {
            background: #2ecc71;
            border-color: #2ecc71;
            color: white;
            animation: pulse 0.5s;
        }

        .option-btn.wrong {
            background: #e74c3c;
            border-color: #e74c3c;
            color: white;
            animation: shake 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .feedback {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .feedback.show {
            opacity: 1;
        }

        .feedback.success {
            background: #d4edda;
            color: #155724;
        }

        .feedback.error {
            background: #f8d7da;
            color: #721c24;
        }

        .next-btn {
            display: block;
            margin: 20px auto;
            padding: 15px 40px;
            font-size: 1.2em;
            background: #764ba2;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s;
        }

        .next-btn.show {
            opacity: 1;
        }

        .next-btn:hover {
            background: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }

        .completion {
            text-align: center;
            padding: 40px;
        }

        .completion h2 {
            color: #2ecc71;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .restart-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
        }

        .restart-btn:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ“ Impara i Complementi</h1>
        
        <div class="level-info" id="levelInfo">
            <h2 id="levelTitle">Livello 1: Associa domande e complementi</h2>
            <p id="levelDescription">Clicca su un complemento a destra, poi clicca sulla domanda corrispondente a sinistra</p>
        </div>

        <div class="progress" id="progress">Domanda 1 di 12</div>

        <div class="question-area">
            <div class="question" id="question"></div>
        </div>

        <div class="association-container" id="associationContainer" style="display: none;">
            <div class="column">
                <div class="column-title">DOMANDE</div>
                <div id="questionsColumn"></div>
            </div>
            <div class="column">
                <div class="column-title">COMPLEMENTI</div>
                <div id="complementsColumn"></div>
            </div>
        </div>

        <div class="options-grid" id="options"></div>

        <div class="feedback" id="feedback"></div>

        <button class="next-btn" id="nextBtn" onclick="nextQuestion()">Avanti â†’</button>

        <div class="completion" id="completion" style="display: none;">
            <h2>ðŸŽ‰ Complimenti!</h2>
            <p style="font-size: 1.3em; margin: 20px 0;">Hai completato tutti i livelli!</p>
            <button class="restart-btn" onclick="restart()">Ricomincia</button>
        </div>

        <!-- Pannello Certificato -->
        <div id="certificatePanel" style="margin-top: 30px;"></div>
    </div>

    <!-- Sistema Certificazione -->
    <script src="https://certificationsystem.netlify.app/certification-system.js"></script>

    <script>
        const complementi = [
            { domanda: "chi? che cosa?", complemento: "OGGETTO", esempio: "Pietro mangia un panino", evidenziato: "un panino" },
            { domanda: "di chi? di che cosa?", complemento: "SPECIFICAZIONE", esempio: "mangio dal piatto di Silvia", evidenziato: "di Silvia" },
            { domanda: "dove?", complemento: "LUOGO", esempio: "Giuseppe vive a Roma", evidenziato: "a Roma" },
            { domanda: "con chi? con che cosa?", complemento: "COMPAGNIA", esempio: "Ã¨ partito con gli amici", evidenziato: "con gli amici" },
            { domanda: "con quale mezzo?", complemento: "MEZZO", esempio: "Ã¨ partita con la bicicletta", evidenziato: "con la bicicletta" },
            { domanda: "quando?", complemento: "TEMPO", esempio: "tornerÃ² alle sei", evidenziato: "alle sei" },
            { domanda: "a chi? a che cosa?", complemento: "TERMINE", esempio: "ho riferito a tua mamma", evidenziato: "a tua mamma" },
            { domanda: "come?", complemento: "MODO", esempio: "ragiona con calma", evidenziato: "con calma" },
            { domanda: "di che materia?", complemento: "MATERIA", esempio: "fanno una torta di cioccolata", evidenziato: "di cioccolata" },
            { domanda: "a causa di chi? a causa di che cosa?", complemento: "CAUSA", esempio: "sono chiusi per sciopero", evidenziato: "per sciopero" },
            { domanda: "da chi?", complemento: "D'AGENTE", esempio: "Ã¨ stato sorpreso dal fratello", evidenziato: "dal fratello" },
            { domanda: "da che cosa?", complemento: "DI CAUSA EFFICIENTE", esempio: "Ã¨ stato colpito dalla palla", evidenziato: "dalla palla" }
        ];

        let currentLevel = 1;
        let currentQuestion = 0;
        let shuffledData = [];
        let correctAnswers = 0;
        let level1Associations = {};
        let selectedComplement = null;
        let certSystem = null;

        //#region Inizializzazione Sistema Certificazione
        function initCertSystem() {
            certSystem = new CertificationSystem({
                appName: 'Impara i Complementi',
                appVersion: '1.0.0',
                storageKey: 'complementi_data',
                certUrl: 'https://certificationsystem.netlify.app/',
                trackFocus: true,
                
                fields: [
                    { key: 'livello1', label: 'Livello 1 Completato', showZero: false },
                    { key: 'livello2', label: 'Livello 2 Completato', showZero: false },
                    { key: 'livello3', label: 'Livello 3 Completato', showZero: false },
                    { key: 'corrette', label: 'Risposte Corrette', showZero: false },
                    { key: 'errori', label: 'Errori Totali', showZero: true },
                    { key: 'tentativi_liv1', label: 'Tentativi Livello 1', showZero: true }
                ],
                
                onFieldUpdate: () => {
                    // Aggiorna statistiche se necessario
                }
            });
            
            // Render pannello certificato
            certSystem.renderFullPanel('certificatePanel', {
                collapsible: true,
                showStudentControls: true,
                showClassroomToggle: false,
                showVerificationToggle: false
            });
        }
        //#endregion

        function shuffle(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function startLevel(level) {
            currentLevel = level;
            currentQuestion = 0;
            correctAnswers = 0;
            level1Associations = {};
            selectedComplement = null;
            
            if (level === 1) {
                shuffledData = complementi;
            } else {
                shuffledData = shuffle(complementi);
            }
            
            const levelTitles = [
                "Livello 1: Associa domande e complementi",
                "Livello 2: Identifica la domanda corretta",
                "Livello 3: Trova il complemento giusto"
            ];
            
            const levelDescriptions = [
                "Clicca su un complemento a destra, poi clicca sulla domanda corrispondente a sinistra",
                "Leggi la frase e clicca sulla domanda a cui risponde la parte evidenziata",
                "Leggi la frase e clicca sul complemento corretto della parte evidenziata"
            ];
            
            document.getElementById('levelTitle').textContent = levelTitles[level - 1];
            document.getElementById('levelDescription').textContent = levelDescriptions[level - 1];
            
            if (level === 1) {
                showLevel1();
            } else {
                showQuestion();
            }
        }

        function showLevel1() {
            document.getElementById('progress').style.display = 'none';
            document.querySelector('.question-area').style.display = 'none';
            document.getElementById('options').style.display = 'none';
            document.getElementById('feedback').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';
            
            document.getElementById('associationContainer').style.display = 'grid';
            
            const questionsColumn = document.getElementById('questionsColumn');
            const complementsColumn = document.getElementById('complementsColumn');
            const feedbackEl = document.getElementById('feedback');
            
            questionsColumn.innerHTML = '';
            complementsColumn.innerHTML = '';
            feedbackEl.classList.remove('show', 'success', 'error');
            
            complementi.forEach((item, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.textContent = item.domanda;
                questionDiv.dataset.index = index;
                questionDiv.onclick = () => selectQuestion(index);
                questionsColumn.appendChild(questionDiv);
            });
            
            const shuffledComplements = shuffle([...complementi]);
            shuffledComplements.forEach((item) => {
                const complementDiv = document.createElement('div');
                complementDiv.className = 'complement-item';
                complementDiv.textContent = item.complemento;
                complementDiv.dataset.complemento = item.complemento;
                complementDiv.onclick = () => selectComplement(item.complemento, complementDiv);
                complementsColumn.appendChild(complementDiv);
            });
            
            Object.keys(level1Associations).forEach(questionIndex => {
                const questionEl = questionsColumn.children[questionIndex];
                questionEl.classList.add('matched');
                
                const complemento = level1Associations[questionIndex];
                Array.from(complementsColumn.children).forEach(el => {
                    if (el.dataset.complemento === complemento) {
                        el.classList.add('matched');
                    }
                });
            });
        }

        function selectComplement(complemento, element) {
            document.querySelectorAll('.complement-item').forEach(el => {
                if (!el.classList.contains('matched')) {
                    el.classList.remove('selected');
                }
            });
            
            if (!element.classList.contains('matched')) {
                element.classList.add('selected');
                selectedComplement = complemento;
            }
        }

        function selectQuestion(questionIndex) {
            if (!selectedComplement) return;
            
            const questionEl = document.querySelectorAll('.question-item')[questionIndex];
            if (questionEl.classList.contains('matched')) return;
            
            const correctComplement = complementi[questionIndex].complemento;
            const feedbackEl = document.getElementById('feedback');
            
            if (selectedComplement === correctComplement) {
                // CORRETTO
                level1Associations[questionIndex] = selectedComplement;
                
                questionEl.classList.add('matched');
                
                const complementEls = document.querySelectorAll('.complement-item');
                complementEls.forEach(el => {
                    if (el.dataset.complemento === selectedComplement) {
                        el.classList.add('matched');
                        el.classList.remove('selected');
                    }
                });
                
                feedbackEl.textContent = 'âœ“ Corretto!';
                feedbackEl.classList.add('success', 'show');
                feedbackEl.classList.remove('error');
                
                // Incrementa risposte corrette
                certSystem.incrementField('corrette');
                
                selectedComplement = null;
                
                if (Object.keys(level1Associations).length === complementi.length) {
                    setTimeout(() => {
                        feedbackEl.textContent = 'ðŸŽ‰ Perfetto! Passi al Livello 2!';
                        
                        // Segna livello 1 come completato
                        certSystem.setField('livello1', 1);
                        
                        setTimeout(() => {
                            startLevel(2);
                        }, 1500);
                    }, 1000);
                } else {
                    setTimeout(() => {
                        feedbackEl.classList.remove('show');
                    }, 1000);
                }
            } else {
                // SBAGLIATO
                feedbackEl.textContent = 'âœ— Sbagliato! Riprova da capo';
                feedbackEl.classList.add('error', 'show');
                feedbackEl.classList.remove('success');
                
                // Registra errore e tentativo
                certSystem.incrementField('errori');
                certSystem.incrementField('tentativi_liv1');
                
                document.querySelectorAll('.complement-item, .question-item').forEach(el => {
                    el.style.pointerEvents = 'none';
                });
                
                setTimeout(() => {
                    document.querySelectorAll('.complement-item, .question-item').forEach(el => {
                        el.style.pointerEvents = 'auto';
                    });
                    
                    level1Associations = {};
                    selectedComplement = null;
                    showLevel1();
                }, 2000);
            }
        }

        function showQuestion() {
            document.getElementById('progress').style.display = 'block';
            document.querySelector('.question-area').style.display = 'flex';
            document.getElementById('options').style.display = 'grid';
            document.getElementById('feedback').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'block';
            
            document.getElementById('associationContainer').style.display = 'none';
            
            if (currentQuestion >= shuffledData.length) {
                if (currentLevel < 3) {
                    // Segna livello come completato
                    certSystem.setField('livello' + currentLevel, 1);
                    
                    setTimeout(() => {
                        startLevel(currentLevel + 1);
                    }, 1500);
                } else {
                    // Tutti i livelli completati
                    certSystem.setField('livello3', 1);
                    showCompletion();
                }
                return;
            }

            const data = shuffledData[currentQuestion];
            const questionEl = document.getElementById('question');
            const optionsEl = document.getElementById('options');
            const feedbackEl = document.getElementById('feedback');
            const nextBtn = document.getElementById('nextBtn');
            
            document.getElementById('progress').textContent = `Domanda ${currentQuestion + 1} di ${shuffledData.length}`;
            
            feedbackEl.classList.remove('show', 'success', 'error');
            nextBtn.classList.remove('show');
            optionsEl.innerHTML = '';

            if (currentLevel === 2) {
                const parts = data.esempio.split(data.evidenziato);
                questionEl.innerHTML = `${parts[0]}<span class="highlight">${data.evidenziato}</span>${parts[1]}`;
                
                const options = shuffle([...complementi.map(c => c.domanda)])
                    .slice(0, 4);
                
                if (!options.includes(data.domanda)) {
                    options[Math.floor(Math.random() * options.length)] = data.domanda;
                }
                
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = opt;
                    btn.onclick = () => checkAnswer(opt === data.domanda, btn);
                    optionsEl.appendChild(btn);
                });
                
            } else if (currentLevel === 3) {
                const parts = data.esempio.split(data.evidenziato);
                questionEl.innerHTML = `${parts[0]}<span class="highlight">${data.evidenziato}</span>${parts[1]}`;
                
                const options = shuffle([...complementi.map(c => c.complemento)])
                    .filter((v, i, a) => a.indexOf(v) === i)
                    .slice(0, 4);
                
                if (!options.includes(data.complemento)) {
                    options[Math.floor(Math.random() * options.length)] = data.complemento;
                }
                
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = opt;
                    btn.onclick = () => checkAnswer(opt === data.complemento, btn);
                    optionsEl.appendChild(btn);
                });
            }
        }

        function checkAnswer(isCorrect, btn) {
            const feedbackEl = document.getElementById('feedback');
            const nextBtn = document.getElementById('nextBtn');
            const allButtons = document.querySelectorAll('.option-btn');
            
            allButtons.forEach(b => b.style.pointerEvents = 'none');
            
            if (isCorrect) {
                btn.classList.add('correct');
                feedbackEl.textContent = 'âœ“ Corretto!';
                feedbackEl.classList.add('success', 'show');
                correctAnswers++;
                nextBtn.classList.add('show');
                
                // Incrementa risposte corrette
                certSystem.incrementField('corrette');
            } else {
                btn.classList.add('wrong');
                feedbackEl.textContent = 'âœ— Sbagliato! Riparti dal livello 1';
                feedbackEl.classList.add('error', 'show');
                
                // Registra errore
                certSystem.incrementField('errori');
                
                setTimeout(() => {
                    startLevel(1);
                }, 2000);
            }
        }

        function nextQuestion() {
            currentQuestion++;
            showQuestion();
        }

        function showCompletion() {
            document.getElementById('levelInfo').style.display = 'none';
            document.getElementById('progress').style.display = 'none';
            document.querySelector('.question-area').style.display = 'none';
            document.getElementById('options').style.display = 'none';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('associationContainer').style.display = 'none';
            document.getElementById('completion').style.display = 'block';
        }

        function restart() {
            document.getElementById('levelInfo').style.display = 'block';
            document.getElementById('completion').style.display = 'none';
            startLevel(1);
        }

        // Inizializzazione
        window.addEventListener('DOMContentLoaded', () => {
            initCertSystem();
            startLevel(1);
        });
    </script>
</body>
</html>
